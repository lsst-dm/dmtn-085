\subsection{Provenance}
\label{sec:comp:provenance}

Derived from \S\S\ref{sec:design:debug} \& \ref{sec:design:drill}.

An effective provenance system is key to any form of QA work: it is clearly necessary to understand where a particular result came from in order to investigate issues it raises.
This is necessary for stand-alone quality analysis, but is fundamental to the proper operation of drill-down and metric-tracking systems.
Furthermore, some high level aggregate data products that are derived from provenance data --- for example, the number of images that contribute to each coadd patch --- are important in QA work.

The QAWG notes that provenance has long been discussed within DM, but detailed plans and timelines have historically been fragmentary\footnote{We hope the ongoing middleware development effort is remedying this!}.
We are concerned that the lack of an effective provenance system is a major barrier to productivity.

\begin{recommendation}
  {rec:comp:provenance}
  {The design and implementation of the provenance system should have high priority in the project scheduling}
\end{recommendation}

The QAWG believes that the requirements on provenance tracking are adequate as described in the Data Management Middleware Requirements (\citeds{LDM-556}) and Data Management Data Backbone Services Requirements (\citeds{LDM-635}).
QA use cases provide no further requirements.

In the Generation 3 Middleware design, Butler/PipelineTask framework is responsible for recording provenance.
For production runs, the Data Backbone Services may collect and store additional provenance information --- for example from the Batch Production Service --- in addition to that generated by Butler and/or PipelineTask.
In the QA use cases, though, we expect the primary source of provenance will be Butler and PipelineTask.

In the Generation 3 Middleware, each dataset can be linked to provenance information such as input datasets, pipeline definition, configurations, and software version (e.g. DMS-MWST-REQ-0024 and DMS-MWBT-REQ-0096 in LDM-556).
Assuming that the recommendation of \S\ref{rec:sec:comp:metric:define:dataId} is adopted, \glspl{metric value} will be stored as Butler datasets and will have associated Data IDs.
This will enable their provenance to be traced in the same way as other datasets.

The QAWG does not place strong requirements on per-source provenance of catalogs and database records.
The current design is that each database record in the production database is either ingested from a file, of which the full provenance is traced, or from an uniquely identifiable execution.
This design does not directly provide detailed per-source provenance --- such as which input images actually contribute to the measurement of a particular source --- but rather enables us to trace the full set of inputs that \textit{could have} contributed to the source.
We suggest that this is adequate; if necessary, additional tooling to e.g. investigate the composition of coadds can be added to the drill-down system (\S\ref{sec:design:drill}).
