\documentclass[DM,authoryear,toc,lsstdraft]{lsstdoc}
\usepackage[nonumberlist,nogroupskip,toc,numberedsection=autolabel]{glossaries}
\makeglossaries
\input{glossary}

\input meta.tex

\title{QA Strategy Working Group Report}

\author{%
Bellm, E.C.,
Chiang, H.-F.,
Fausti, A.,
Krughoff, K.S.,
MacArthur, L.A.,
Morton, T.D.,
Swinbank, J.D and
Roby, T.
}

\setDocRef{\lsstDocType-\lsstDocNum}
\date{\vcsDate}

\setDocAbstract{%
Abstract.
}

\setDocChangeRecord{%
  \addtohist{\vcsRevision}{\vcsDate}{Unreleased draft.}{Bellm et al.}
}

% For specific WG recommendations
\newenvironment{recommendation}[1][]
{
  \begin{admonition}{green!5!white}{green!75!black}{Recommendation}{#1}
}
{
  \end{admonition}
}

\begin{document}

% For specific WG recommendations
\newcommand{\assign}[1]{
  \begin{admonition}{red!5!white}{red!75!black}{Assignee}{}#1\end{admonition}
}

\maketitle

\section{Introduction}
\label{sec:intro}

\assign{John}

This report constitutes the primary artefact produced by the DM \gls{qawg},
addressing its charge as defined in \citeds{LDM-622}.

\section{Approach to the Problem}

\assign{John}

\subsection{Pipeline debugging}

\assign{John}

What tools do we need to help pipeline developers with their everyday work?

\begin{itemize}

  \item{How do you go about debugging a \texttt{Task} that is crashing?}
  \item{Is \texttt{lsstDebug} adequate?}
  \item{Do we need an afwFigure, for generating plots, to go alongside \texttt{afwDisplay}, for showing images?}
  \item{What additional capabilities are needed for developers running and debugging at scale, e.g. log collection, identification of failed jobs, etc.}
  \item{What's needed from an image viewer for pipeline developers? Is DS9 or Firefly adequate? Is there value to the afwDisplay abstraction layer, or does it simply make it harder for us to use Firefly's advanced features?}
  \item{How do we view images which don't fit in memory on a single node?}
  \item{How do we handle fake sources? Is this a provenance issue?}

\end{itemize}

\subsection{Drill down}

\assign{John}

\subsection{Datasets and test infrastructure}

\assign{John}

\section{Design sketch}

\subsection{Pipeline debugging}

\assign{John}

\subsection{Drill down}

\assign{Tim}

\subsection{Datasets and test infrastructure}

\assign{John}

\section{Core components}

\subsection{Updated pipeline debugging system}

\assign{Simon}

i.e. redesigned \texttt{lsstDebug}.

\subsection{Logging}

\assign{Simon}

\subsection{Capability for developers to run pipelines at scale}

\assign{Lauren}

\subsection{Guidance on visualization}

\assign{Lauren}

We're requesting a set of guidelines for developers here, not a new framework
--- but that's still a concrete deliverable (it's just documentation, rather
than code). We might suggest that these guidelines be developed by a new WG,
per Simon's
suggestion\footnote{\url{https://confluence.lsstcorp.org/display/DM/Pipeline+Debugging+Design}}.

\subsection{Image viewer}

\assign{Trey}

There are two approaches to doing image visualization.
When a developer is working on a laptop with a
small amount of data and viewing image results locally then DS9 or an equivalent desktop application seems
to be the best solution, primarily because of the ease of setup.

In the server-based environment of the LSP Notebook Aspect, where services can be more centrally provided,
the use of Firefly-based image visualization becomes practical and will permit providing more advanced
and LSST-customized behavior.
When the data themselves are already being manipulated on a remote server,
the use of a co-located visualization server can provide better performance.

Experience so far has shown that different users, at different times, prefer one or the other of the models of having image displays ``next to'' their Python session --- the only approach available with DS9 --- or embedded in a scrolling notebook.
Which is more useful scientifically or pedagogically often depends on what the immediate purpose is.
In the latest JupyterLab environment, a third option is available of having image visualization in a separate ``tab'' in the JupyterLab layout.

To be effective for QA applications Firefly should have the following functionality:
\begin{itemize}
  \item{Work as a standalone tool;}
  \item{Work as an implementation of the \verb|afw.display| API;}
  \item{Provide a low-level Python API that allows its use with data that may not be in \verb|afw| formats; this API may also allow Firefly to}
  \item{Provide additional / more advanced features than are supported in the \verb|afw.display| base class;\footnote{These might get migrated to inclusion in \verb|afw.display| over time.}}
  \item{Work as an extension in Jupyter Lab (or example: click on a FITS file and see it show in Firefly);}
  \item{Work as a Jupyter Notebook widget, supporting JupyterLab's ``tear-off'' feature to move it to a tab;}
  \item{Provide a way to overlay tabular data on images;}
  \item{Provide HiPS viewing;}
  \item{Provide visualizations for LSST's image masks, object \verb|Footprints|, and other specialized classes;}
  \item{Support all major QA use cases and ensure good performance; and}
  \item{Implement full focal plane visualization.}
\end{itemize}



\subsection{Catalog visualization tools}

\assign{Lauren}

For visualizing bigger-than-memory catalogs. May include e.g. the capability
to spin up Dask clusters on demand, combined with
Holoviews/Datashader/whatever. Somebody who knows about this stuff needs to
write a summary...

\subsection{Provenance}

\assign{Hsin-Fang}

This section should note:

\begin{itemize}

  \item{That provenance is an immediate issue impacting QA work, so a solution
  is a priority;}

  \item{Some requirements as to the granularity at which provenance tracking
  is necessary for QA.}

\end{itemize}

\appendix
\glsaddall
\printglossary[style=index]

\bibliography{lsst,lsst-dm,refs_ads,refs,books}

\end{document}
